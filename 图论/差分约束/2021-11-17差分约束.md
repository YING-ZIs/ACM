#  🏹差分约束

    这名字听起来也太高级了吧！！！(确实很高级)
    
##  差分约束系统概念
    
    差分约束系统即为对于许多未知数之间相互有关联，存在许多限制，在满足所有条件的情况下求出其可能的取值。
    
    例如x1 - x2 >= 2
        x2 - x3 >= 4
        x5 - x3 <= 3
        ........
    我么们需要在满足这些条件下求出最小值或最大值！！
---
##  差分约束思想
    
    🧢真的太奇妙了，你可能从未想到这么多的不等式竟然可以通过最短路思想完成。从数学推导到图论大法ORZ!!
    
* 最短路构想  
```diff
     我们观察如果我们把一些式子都化成x1-x2<=k的形式,即如果原式为x1-x2>=3，那么我们就化成x2-x1<=-3,
     然后我们考虑所有左边函数名都一样的不等式
     即为 x2 <= k1+x1 , x2 <= k2+x3 , x2 <= k3+x3......
     所以如果我们想要求出x2的最小的可能取值那是不是只需要满足
     x2<=min{ k1+x1 , k2+x2 , k3+x3,....}
     我们用dis表示x2的值的话，这是不是和最短的想法是一样的，可以设想成每一个未知数都是一个节点，k代表与
     当前节点链接的一条边的权值。
     那么我们如果满足上述所有式子，那不就是求了一个最短路吗？😲
     这样求出来的是x2的最大值
```
* 最长路
```diff
    同样的我们如果都把他们化成了
    x1 >= x2+k的形式，我们只需要在求一个最长路，即可求出x1的最小值。
```
```C++
    if(dis[to] < dis[u]+w){//更改为最长路
        dis[to]=dis[u]+w;
    }
```
```diff
+ 所以总的来说，如果我们想要求出来一个数的最小值，我们就跑一个最长路，如果想要求一个数的最大值就求一个最短路
```
---
### 差分约束分类

```diff
!  因为我们把一个数学推导转化成了图论，那么我们就要考虑这个构成的图是否联通，以及是否都需要联通。
```
* 必须联通型    
* 不必须连通性

   🩹不必须连通型(每一点并不一定和所有的点都满足一定的关系)
```diff        
    这种的条件比较简单，可能就是单纯的想让我们求解一些每一个的正确的取值。
    (1)比如说这道题  
```        
   [P5960 【模板】差分约束算法](https://www.luogu.com.cn/problem/P5960)  
```diff
    因为并不是每两个未知量都是具有关系的，所以我们如果只连题中给出的边的话，整个图就被分成了几个图，其实对于本题而言，它只是
    让我们求出每一个的可行解。那我们只需把每一个点都设成相同的值。因为本图不连通，也就没有超级源点，所以我们只需在第一步里面把
    所有的点都加进去，然后跑SPFA即可。
    (2)还有这道经典题  
```        
   [P3275 [SCOI2011]糖果](https://www.luogu.com.cn/problem/P3275)
```diff
    其实这道题和模板题基本一样，唯一不同的地方是，因为每一个小朋友都需要分到糖果，所以我们有两种方法：
    🧸第一种是把所有的dis都初始化成1然后，按不连通图去做
    接下来讲下一种方法QWQ
```
    🍬联通型
```diff
    这类题型是去找到一种构造方法，是的整张图都是联通的。
    比如说上面的那道糖果题：
    因为我们知道每一个小朋友都是至少要拿一个的，所以我们可以建立一个超级源点0，设置dis为每一个小朋友的糖果所得数，那也就是说
    我们可以知道对于每一个x dis[x]-dis[0] >= 1这是必然的，所以我们可以给每一个点都建立一条边权为1的边，那么就将整张图连起来可以
    直接跑SPFA
    
    其中需要连通图最常见的地方就是将dis的含义设定为前缀和。
    就如同
```
 [P1250 种树](https://www.luogu.com.cn/problem/P1250)
 [P3084 [USACO13OPEN]Photo G](https://www.luogu.com.cn/problem/P3084)
 
```diff
    这两道题让我们求得都是存在的最大值或最小值。
    那我们可以将dis的含义设定为前缀和，某点处为1代表有，0代表没有。
    所以我们只要求出dis[n]的值即可求出最大值或最小值
    
    
    首先我们会根据题目中给出的要求正确的建边，但这样是不够的，因为如果我们要求前缀和的话，必须是联通的，不然就只能求出局部信息。
    但对于这道题而言，因为我们保证的前缀和具有不减的性质(这一点要不么有，要么没有)那么我们可以列出方程式：
    0<=dis[i]-dis[i-1]<=1
    所以我们就对相邻的两个点练出了两个边而是整张图都是联通的。那么我们就按需求去跑SPFA就可以了
    
    
    但按照前缀和并不是去求值只是去判断是否合法的话并不用保证上面的不等式
    例如下面的题：
```
[P2294 [HNOI2005]狡猾的商人](https://www.luogu.com.cn/problem/P2294)
```diff
    其实说是前缀和，但是联系没有那么紧密，(因为没有保证单调不减)。
    这里的联系不紧密的意思是，因为有亏损也就是说，如果我们不清楚一个点处的亏盈情况那么dis[i-1]和dis[i+1]就没有太大的联系，
    所以我们只需要考虑存在关系的即可。
```

### 接下来说一些需要注意的地方

```diff
+   如果方程式为 x1-x2=k那么就需要建两个边 x1-x2>=k x1-x2<=k
+   如果定义dis为前缀和，并且保证单调不减那么就可以设 0 <= dis[i]-dis[i-1] <= 1
```
